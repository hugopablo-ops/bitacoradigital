<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitácora Digital: Decisiones en tiempo real para negocios reales</title>
  <meta name="description" content="Educación aplicada basada en Web3, IA, Analítica, DeFi, TradFi y Fintech. Dashboards claros, comparativos logarítmicos y podcast." />
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Tema base (oscuro) minimal -->
  <style>
    :root{
      --bg:#0f172a; --bg-alt:#111827; --card:#0b1220;
      --muted:#94a3b8; --text:#e2e8f0; --accent:#34d399; --border:#1f2937;
      --chip:#1e293b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}

    /* NAV (simple) */
    .nav{position:sticky;top:0;background:rgba(15,23,42,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:20}
    .nav__inner{display:flex;align-items:center;gap:16px;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand__logo{width:22px;height:22px}
    .nav__links{margin-left:auto;display:flex;gap:18px}
    .nav__links a{color:var(--muted)}
    .nav__links a:hover{color:var(--text)}

    /* HERO */
    .hero{padding:36px 0 20px;border-bottom:1px solid var(--border)}
    .hero__inner{display:grid;grid-template-columns:1.2fr .8fr;gap:24px}
    @media (max-width:900px){ .hero__inner{grid-template-columns:1fr} }
    .hero h1{font-size:clamp(26px,4vw,44px);line-height:1.1;margin:6px 0 8px}
    .accent{color:var(--accent)}
    .muted{color:var(--muted)}
    .hero__cta{display:flex;flex-wrap:wrap;gap:12px;margin-top:14px}
    .btn{padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:transparent}
    .btn:hover{border-color:#334155}
    .btn--primary{background:#2563eb;border-color:#2563eb;color:white}
    .chips{display:flex;gap:10px;margin-top:8px}
    .chip{background:var(--chip);color:#cbd5e1;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:.85rem}

    /* BLOQUE ANALÍTICO (grilla 2×3) */
    #bd-analytic{padding:28px 0 8px}
    .bd-head h2{margin:.2rem 0 .4rem}
    .bd-head p{margin:0 0 12px;color:var(--muted)}
    .bd-grid{display:grid;gap:20px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1024px){ .bd-grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:680px){ .bd-grid{grid-template-columns:1fr} }
    .bd-card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));border:1px solid var(--border);border-radius:14px;padding:12px 12px 8px;cursor:pointer;transition:.15s;position:relative}
    .bd-card:hover{border-color:#334155}
    .bd-title{font-weight:700;margin:2px 0 2px 6px}
    .bd-sub{color:var(--muted);font-size:.9rem;margin:0 0 8px 6px}
    .bd-chart{width:100%;height:300px}
    .bd-note{color:var(--muted);font-size:.9rem;padding:6px}

    /* Tooltip del gráfico */
    .bd-tip{
      position:absolute; pointer-events:none;
      background:rgba(17,24,39,.92); color:#e2e8f0;
      border:1px solid rgba(255,255,255,.1); border-radius:10px;
      padding:8px 10px; font-size:.85rem;
      box-shadow:0 6px 20px rgba(0,0,0,.35);
      transform:translate(8px,8px); opacity:0; transition:opacity .08s ease;
      z-index:5; white-space:nowrap;
    }
    .bd-tip.show{opacity:1}
    .bd-tip .row{display:flex;gap:10px;align-items:center;line-height:1.25}
    .bd-tip .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}
    .bd-tip .k{color:#a0aec0;margin-bottom:4px;display:block}
    /* contenedor posicionado relativo para alojar el tooltip */
    .bd-card .tip-wrap{position:absolute;left:10px;top:10px}
  </style>

  <!-- Lightweight Charts (CDN) -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container nav__inner">
      <div class="brand">
        <img src="assets/favicon.svg" alt="" class="brand__logo">
        <strong>Bitácora Digital</strong>
      </div>
      <nav class="nav__links">
        <a href="#dashboards">Dashboards</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
        <a href="#roadmap">Roadmap</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero__inner">
      <div>
        <h1>Bitácora Digital: <span class="accent">Decisiones en tiempo real</span> para negocios reales</h1>
        <p class="muted">
          Educación aplicada basada en <strong>Web3, IA, Analítica, DeFi, TradFi y Fintech</strong>.
          Visión: individuos capacitados para integrar finanzas y tecnología.
        </p>
        <div class="hero__cta">
          <a class="btn btn--primary" href="#dashboards">Ver comparativos</a>
          <a class="btn" href="#podcast">Escuchar podcast</a>
          <a class="btn" href="#servicios">Servicios</a>
          <a class="btn" href="#bd-labs">BD Labs</a>
          <a class="btn" href="#bd-merch">BD Merchandising</a>
          <a class="btn" href="#contacto">Contacto</a>
        </div>
      </div>
      <div class="chips">
        <span class="chip">CLP</span>
        <span class="chip">BTC</span>
        <span class="chip">ETH</span>
        <span class="chip">UF</span>
      </div>
    </div>
  </section>

  <!-- BLOQUE: Dashboards comparativos -->
  <section id="bd-analytic" class="container">
    <div class="bd-head">
      <h2>Dashboards comparativos</h2>
      <p>Series mensuales, <em>logarítmicas</em> y normalizadas a <strong>Base 100</strong>. Todos los gráficos están sincronizados.</p>
    </div>

    <div class="bd-grid" id="dashboards">
      <!-- 1) TradFi Chile -->
      <article class="bd-card" id="card-chile" onclick="location.href='/detail/tradfi-cl'">
        <h3 class="bd-title">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
        <p class="bd-sub">UF / US$ desde mindicador.cl · IPSA vía ETF ECH (Stooq)</p>
        <div class="tip-wrap"><div class="bd-tip" id="tip-chile"></div></div>
        <div id="c-chile" class="bd-chart"></div>
        <div id="c-chile-note" class="bd-note" style="display:none"></div>
      </article>

      <!-- 2) Índices (placeholder) -->
      <article class="bd-card" id="card-indices" onclick="location.href='/detail/indices'">
        <h3 class="bd-title">Índices — SPY (S&amp;P500) vs EWG (DAX) vs EWJ (Nikkei)</h3>
        <p class="bd-sub">ETF proxies vía Stooq (mensual)</p>
        <div class="bd-note">Próximamente.</div>
      </article>

      <!-- 3) Big Tech (placeholder) -->
      <article class="bd-card" id="card-tech" onclick="location.href='/detail/tech'">
        <h3 class="bd-title">Big Tech / IA — AAPL vs MSFT vs NVDA</h3>
        <p class="bd-sub">Precios USD vía Stooq (mensual)</p>
        <div class="bd-note">Próximamente.</div>
      </article>

      <!-- 4) Crypto Top 8 (placeholder) -->
      <article class="bd-card" id="card-crypto" onclick="location.href='/detail/crypto'">
        <h3 class="bd-title">Crypto · Top 8 (Base 100, últimos 5 años)</h3>
        <p class="bd-sub">BTC, ETH, SOL, BNB, XRP, ADA, LINK, DOT — CoinGecko (USD)</p>
        <div class="bd-note">Próximamente.</div>
      </article>

      <!-- 5) Commodities (placeholder) -->
      <article class="bd-card" id="card-commod" onclick="location.href='/detail/commodities'">
        <h3 class="bd-title">Commodities (ETF) — IAU (Oro) vs SLV (Plata) vs BNO (Brent)</h3>
        <p class="bd-sub">ETF proxies vía Stooq (mensual)</p>
        <div class="bd-note">Próximamente.</div>
      </article>

      <!-- 6) Slot libre -->
      <article class="bd-card">
        <h3 class="bd-title">Próximamente</h3>
        <p class="bd-sub">Otro comparativo que elijas</p>
        <div class="bd-note">Sugerencias: LatAm, Small Caps, o BTC vs Oro vs SPY.</div>
      </article>
    </div>
  </section>

  <!-- (Opcional) LO QUE HACEMOS / PODCAST / FOOTER… tu contenido actual debajo -->
  <section id="servicios" class="container" style="padding:28px 0 60px">
    <h2>Lo que hacemos</h2>
    <p class="muted">…(tu bloque existente aquí) …</p>
  </section>

  <!-- === Scripts === -->
  <script>
  (function(){
    // ===== Paleta fija =====
    const COLORS = {
      uf:      "#63b3ed", // celeste
      usdclp:  "#f6ad55", // naranja
      ipsa:    "#97a7ea"  // lavanda
    };

    // ===== Utilidades =====
    const isoMonth = d => {
      const y = d.getUTCFullYear(), m = String(d.getUTCMonth()+1).padStart(2,"0");
      return `${y}-${m}-01`;
    };

    // Normaliza a Base 100 desde primer dato válido
    function base100(arr){
      if(!arr || !arr.length) return arr;
      const i = arr.findIndex(p => Number.isFinite(p.value));
      if(i<0) return arr;
      const b = arr[i].value;
      return arr.map(p => ({ time:p.time, value:(p.value/b)*100 }));
    }

    // Intersección de fechas (para comparar mismo rango)
    function intersectDates(seriesArray){
      const sets = seriesArray.map(s => new Set(s.map(p=>p.time)));
      const common = [...sets[0]].filter(t => sets.every(S => S.has(t))).sort((a,b)=>a.localeCompare(b));
      return seriesArray.map(s => s.filter(p => common.includes(p.time)));
    }

    // mindicador.cl (uf / dolar) — diario → mensual (último del mes)
    async function fetchMindicador(tipo){
      const r = await fetch(`https://mindicador.cl/api/${tipo}`, { cache:'no-store' });
      if(!r.ok) throw new Error(`mindicador ${tipo} ${r.status}`);
      const j = await r.json(); // j.serie: [{fecha, valor}]
      const pts = j.serie.map(x=>{
        const d = new Date(x.fecha);
        return { time: isoMonth(new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), 1))), value: Number(x.valor) };
      });
      // compacta a último de mes
      const by = {};
      for(const p of pts) by[p.time] = p.value;
      return Object.entries(by).map(([time,value])=>({time,value})).sort((a,b)=> a.time.localeCompare(b.time));
    }

    // Stooq mensual CSV (ech.us)
    async function fetchStooqMonthly(ticker){
      const url = `https://stooq.com/q/d/l/?s=${ticker}&i=m`;
      const r = await fetch(url, { cache:'no-store' });
      if(!r.ok) throw new Error(`stooq ${ticker} ${r.status}`);
      const csv = await r.text();
      const lines = csv.trim().split(/\r?\n/).slice(1); // header fuera
      const out = [];
      for(const ln of lines){
        const [date,, , ,close] = ln.split(',');
        if(date && close) out.push({ time: date, value: Number(close) });
      }
      return out;
    }

    // ===== CHART CORE =====
    function makeChart(el){
      const { PriceScaleMode } = LightweightCharts;
      const chart = LightweightCharts.createChart(el, {
        layout: { background:{type:'solid', color:'transparent'}, textColor:'#cbd5e0' },
        rightPriceScale:{ borderColor:'#1f2937', mode: PriceScaleMode.Logarithmic },
        timeScale:{ borderColor:'#1f2937' },
        grid:{ vertLines:{ color:'#111827' }, horzLines:{ color:'#111827' } },
        localization:{ locale:'es-CL' }
      });
      return chart;
    }
    const addLine = (chart, label, color) => chart.addLineSeries({ title:label, color, lineWidth:2 });

    // ===== TradFi · Chile (UF / USDCLP / IPSA-ECH) =====
    async function drawChile(){
      const root = document.getElementById('c-chile');
      const tip = document.getElementById('tip-chile');
      if(!root || !tip) return;

      try{
        const [uf, usd, ech] = await Promise.all([
          fetchMindicador('uf'),
          fetchMindicador('dolar'),
          fetchStooqMonthly('ech.us')
        ]);

        // Alinea por intersección y normaliza a Base 100
        let [sUF, sUSD, sECH] = intersectDates([uf, usd, ech]);
        sUF = base100(sUF); sUSD = base100(sUSD); sECH = base100(sECH);

        // Render
        const chart = makeChart(root);
        const lUF  = addLine(chart, 'UF', COLORS.uf);       lUF.setData(sUF);
        const lUSD = addLine(chart, 'USD/CLP', COLORS.usdclp); lUSD.setData(sUSD);
        const lECH = addLine(chart, 'IPSA (ECH)', COLORS.ipsa); lECH.setData(sECH);

        // Tooltip crosshair
        chart.subscribeCrosshairMove(param => {
          if(!param.time || !param.seriesData) { tip.classList.remove('show'); return; }

          const t = param.time; // YYYY-MM-DD
          const dUF  = param.seriesData.get(lUF);
          const dUSD = param.seriesData.get(lUSD);
          const dECH = param.seriesData.get(lECH);
          if(!dUF || !dUSD || !dECH){ tip.classList.remove('show'); return; }

          tip.innerHTML = `
            <span class="k">${t}</span>
            <div class="row"><span class="dot" style="background:${COLORS.uf}"></span>UF: <strong>${dUF.value.toFixed(1)}</strong></div>
            <div class="row"><span class="dot" style="background:${COLORS.usdclp}"></span>USD/CLP: <strong>${dUSD.value.toFixed(1)}</strong></div>
            <div class="row"><span class="dot" style="background:${COLORS.ipsa}"></span>IPSA (ECH): <strong>${dECH.value.toFixed(1)}</strong></div>
          `;
          tip.classList.add('show');
        });
      }catch(e){
        console.warn(e);
        document.getElementById('c-chile-note').style.display='block';
        document.getElementById('c-chile-note').textContent = 'No se pudo cargar (Chile).';
      }
    }

    // Bootstrap solo el primer cuadrante ahora
    window.addEventListener('DOMContentLoaded', drawChile);
  })();
  </script>
</body>
</html>
