<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitácora Digital — Dashboards + Podcast</title>
  <meta name="description" content="Dashboards limpios con datos de mercados (TradFi, Commodities, Crypto) y podcast de educación financiera y tecnología." />
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container nav__inner">
      <div class="brand">
        <img src="assets/favicon.svg" alt="" class="brand__logo">
        <span class="brand__name">Bitácora Digital</span>
      </div>
      <nav class="nav__links">
        <a href="#dashboards">Dashboards</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
        <a href="#roadmap">Roadmap</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero__inner">
      <div class="hero__copy">
        <h1>Decisiones en <span class="accent">tiempo real</span> para negocios reales</h1>
        <p class="muted">Web3, DeFi, analítica y TradFi — educación aplicada, sin humo. Dashboards claros que se entienden y se usan.</p>
        <div class="hero__cta">
          <a class="btn btn--primary" href="#dashboards">Ver dashboards</a>
          <a class="btn" href="#podcast">Escuchar podcast</a>
        </div>
      </div>
      <div class="hero__snapshot">
        <div class="chip">CLP</div>
        <div class="chip">BTC</div>
        <div class="chip">ETH</div>
        <div class="chip">UF</div>
      </div>
    </div>
  </section>

  <!-- DASHBOARDS -->
  <section id="dashboards" class="section">
    <div class="container">
      <h2 class="section__title">Dashboards</h2>
      <p class="section__subtitle">Vista compacta. Si hay APIs, se actualiza solo. Si no, verás “—” (sin romper nada).</p>

      <!-- FILA: TRADFI CHILE -->
      <h3 class="group__title">TradFi · Chile</h3>
      <div class="grid">
        <article class="card" data-key="UF">
          <header class="card__head">
            <span class="pill">UF</span>
            <span class="muted">Unidad de Fomento</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
        </article>

        <article class="card" data-key="USDCLP">
          <header class="card__head">
            <span class="pill">USD/CLP</span>
            <span class="muted">Dólar observado</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
        </article>

        <article class="card disabled" data-key="IPSA">
          <header class="card__head">
            <span class="pill">IPSA</span>
            <span class="muted">Bolsa de Santiago</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Actívalo con clave gratuita (finnhub / alpha vantage).</div>
        </article>
      </div>

      <!-- FILA: ÍNDICES USA/EU -->
      <h3 class="group__title">Índices · USA / Europa</h3>
      <div class="grid">
        <article class="card disabled" data-key="SP500">
          <header class="card__head"><span class="pill">S&P 500</span><span class="muted">EE.UU.</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
        <article class="card disabled" data-key="DAX">
          <header class="card__head"><span class="pill">DAX</span><span class="muted">Alemania</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
        <article class="card disabled" data-key="NIKKEI">
          <header class="card__head"><span class="pill">Nikkei 225</span><span class="muted">Japón</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
      </div>

      <!-- FILA: TECH STOCKS -->
      <h3 class="group__title">Acciones · Big Tech / IA / Chips</h3>
      <div class="grid">
        <article class="card disabled" data-key="AAPL"><header class="card__head"><span class="pill">AAPL</span><span class="muted">Apple</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="MSFT"><header class="card__head"><span class="pill">MSFT</span><span class="muted">Microsoft</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="NVDA"><header class="card__head"><span class="pill">NVDA</span><span class="muted">NVIDIA</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="TSM"><header class="card__head"><span class="pill">TSM</span><span class="muted">TSMC</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>

      <!-- FILA: CRYPTO (LIVE) -->
      <h3 class="group__title">Crypto · Top 8 (live)</h3>
      <div class="grid">
        <article class="card" data-coin="bitcoin"><header class="card__head"><span class="pill">BTC</span><span class="muted">Bitcoin</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="ethereum"><header class="card__head"><span class="pill">ETH</span><span class="muted">Ethereum</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="solana"><header class="card__head"><span class="pill">SOL</span><span class="muted">Solana</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="ripple"><header class="card__head"><span class="pill">XRP</span><span class="muted">XRP</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="binancecoin"><header class="card__head"><span class="pill">BNB</span><span class="muted">BNB</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="cardano"><header class="card__head"><span class="pill">ADA</span><span class="muted">Cardano</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="chainlink"><header class="card__head"><span class="pill">LINK</span><span class="muted">Chainlink</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="polkadot"><header class="card__head"><span class="pill">DOT</span><span class="muted">Polkadot</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>

      <!-- FILA: COMMODITIES -->
      <h3 class="group__title">Commodities · Metales / Energía</h3>
      <div class="grid">
        <article class="card disabled" data-key="GOLD"><header class="card__head"><span class="pill">Oro</span><span class="muted">XAU</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div><div class="hint">Habilita con MetalsAPI/AlphaVantage.</div></article>
        <article class="card disabled" data-key="SILVER"><header class="card__head"><span class="pill">Plata</span><span class="muted">XAG</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="BRENT"><header class="card__head"><span class="pill">Brent</span><span class="muted">Crudo</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>
    </div>
  </section>

  <!-- MISIÓN / SERVICIOS -->
  <section class="section alt" id="servicios">
    <div class="container">
      <h2 class="section__title">Lo que hacemos</h2>
      <div class="cards-3">
        <article class="card soft">
          <h4>Educación primero</h4>
          <p>Somos un medio educativo: finanzas, IA, blockchain y analítica — sin “shilling” ni promesas mágicas.</p>
        </article>
        <article class="card soft">
          <h4>Dashboards a medida</h4>
          <p>Discovery → Integración → Despliegue → Mantenimiento. Datos que se entienden y toman decisiones.</p>
        </article>
        <article class="card soft">
          <h4>IA / DeFi / Pagos</h4>
          <p>Agentes de IA para tu negocio, consultoría DeFi y pasarelas fiat↔crypto con buenas prácticas.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- PODCAST -->
  <section id="podcast" class="section">
    <div class="container">
      <h2 class="section__title">Podcast</h2>
      <p class="section__subtitle">Escucha los últimos episodios sin salir de la web.</p>
      <div class="embed">
        <iframe style="border-radius:12px" src="https://open.spotify.com/embed/show/1wUiA7esT4Mx8OUA16PSyo?utm_source=generator" width="100%" height="232" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
      </div>
    </div>
  </section>

  <!-- ROADMAP -->
  <section id="roadmap" class="section alt">
    <div class="container">
      <h2 class="section__title">Roadmap</h2>
      <ol class="roadmap">
        <li><strong>v0.1</strong> · Maqueta con dashboard en vivo (Crypto + CLP/UF). ✅</li>
        <li><strong>v0.2</strong> · Conectar índices y acciones con API gratuita (Finnhub/Alpha Vantage). 🔜</li>
        <li><strong>v0.3</strong> · Commodities y alertas simples. 🔜</li>
        <li><strong>v0.4</strong> · Email digests + panel admin para noticias. 🔜</li>
      </ol>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">© 2025 Bitácora Digital</span>
      <div class="footer__links">
        <a href="https://bitacoradigital.io" target="_blank" rel="noopener">Sitio</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
      </div>
    </div>
  </footer>


<!-- Lightweight Charts (gráficos livianos) -->
<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
  .bd-grid { display:grid; gap:24px; margin-top:32px }
  .bd-2 { grid-template-columns: 1fr 1fr }
  .bd-1 { grid-template-columns: 1fr }
  .bd-card { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px }
  .bd-title { font-weight:600; margin:4px 0 10px 6px; opacity:.9 }
  .bd-chart { width:100%; height:360px }
  @media (max-width:1000px){ .bd-2{grid-template-columns:1fr} }
</style>

<section class="container">
  <h2 class="section__title">Dashboards comparativos</h2>
  <p class="section__subtitle">Series normalizadas (Índice = 100 al inicio del rango) para comparar movimientos.</p>

  <div class="bd-grid bd-2">
    <div class="bd-card">
      <h3 class="bd-title">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
      <div id="chart-chile" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">UF/US$ desde mindicador.cl · IPSA proxy vía ECH (Yahoo). Rango: 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Índices · S&P500 (SPY) vs DAX (EWG) vs Nikkei (EWJ)</h3>
      <div id="chart-indices" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance, rango 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Big Tech · AAPL vs MSFT vs NVDA</h3>
      <div id="chart-tech" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance, rango 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Commodities (ETF) · Oro (IAU) vs Plata (SLV) vs Brent (BNO)</h3>
      <div id="chart-commod" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance (ETF proxies), rango 10 años mensuales.</p>
    </div>
  </div>
</section>

<!-- Lightweight Charts (gráficos livianos) -->
<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
  .bd-dash { margin: 36px auto; max-width: 1100px; padding: 0 16px; }
  .bd-card { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; margin-bottom:24px; }
  .bd-title { font-weight:600; margin:4px 0 10px 6px; opacity:.9 }
  .bd-muted { color:#a0aec0; font-size: 0.9rem; margin:6px 4px 0 }
  .bd-chart { width:100%; height:380px }
  .bd-note { color:#cbd5e0; font-size: .85rem; margin: 6px 4px 0 }
</style>

<section class="bd-dash">
  <div class="bd-card">
    <h3 class="bd-title">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
    <div id="chart-chile" class="bd-chart"></div>
    <p class="bd-muted">UF y USD/CLP desde mindicador.cl · IPSA se intenta vía ECH (Yahoo). Rango: 10 años, mensual. Base 100.</p>
    <p id="chart-hint" class="bd-note" style="display:none"></p>
  </div>
</section>

<script>
(function () {
  // === Utilidades ===
  const COLORS = ["#63b3ed","#4fd1c5","#f6ad55","#f56565","#9f7aea"];
  const toIdx100 = (arr) => {
    if (!arr.length) return arr;
    const base = arr[0].value;
    return arr.map(p => ({ time: p.time, value: (p.value / base) * 100 }));
  };
  const makeChart = (el) => LightweightCharts.createChart(el, {
    layout:{ background:{ type:'solid', color:'transparent' }, textColor:'#cbd5e0' },
    rightPriceScale:{ borderColor:'#2d3748' },
    timeScale:{ borderColor:'#2d3748' },
    grid:{ vertLines:{ color:'#1a202c' }, horzLines:{ color:'#1a202c' } },
    localization:{ locale:'es-CL' }
  });
  const addSeries = (chart, title, color, data) => {
    const s = chart.addLineSeries({ title, lineWidth:2, color });
    s.setData(data);
    return s;
  };
  const ym = (date) => {
    const d = new Date(date);
    return d.getUTCFullYear() + "-" + String(d.getUTCMonth()+1).padStart(2,"0");
  };

  // === Datos reales (sin claves) ===
  async function getUFyUSD10y() {
    const now = new Date();
    const startY = now.getUTCFullYear() - 10 + 1; // últimos 10 años
    // UF mensual (mindicador.cl entrega diario; tomamos último de cada mes)
    const ufMonthly = {};
    for (let y = startY; y <= now.getUTCFullYear(); y++) {
      const r = await fetch(`https://mindicador.cl/api/uf/${y}`, { cache:'no-store' });
      const js = await r.json();
      for (const it of (js.serie || [])) {
        const k = ym(it.fecha);
        ufMonthly[k] = it.valor; // último pisa al anterior
      }
    }
    // USD/CLP diario -> promedio mensual
    const usdDailyByM = {};
    for (let y = startY; y <= now.getUTCFullYear(); y++) {
      const r = await fetch(`https://mindicador.cl/api/dolar/${y}`, { cache:'no-store' });
      const js = await r.json();
      for (const it of (js.serie || [])) {
        const k = ym(it.fecha);
        (usdDailyByM[k] ||= []).push(it.valor);
      }
    }
    const usdMonthly = {};
    Object.entries(usdDailyByM).forEach(([k, arr]) => {
      usdMonthly[k] = arr.reduce((a,b)=>a+b,0)/arr.length;
    });
    // Intersección temporal
    const keys = Object.keys(ufMonthly).filter(k => usdMonthly[k]).sort();
    const uf = keys.map(k => ({ time: k + "-01", value: ufMonthly[k] }));
    const usd = keys.map(k => ({ time: k + "-01", value: usdMonthly[k] }));
    return { uf, usd };
  }

  // Yahoo Finance mensual (puede fallar por CORS en algunos navegadores/redes)
  async function getYahooMonthly(ticker, years=10) {
    const range = years + "y";
    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(ticker)}?range=${range}&interval=1mo`;
    const r = await fetch(url, { headers:{ "accept":"application/json" }, cache:"no-store" });
    if (!r.ok) throw new Error(`Yahoo ${ticker} ${r.status}`);
    const data = await r.json();
    const res = data?.chart?.result?.[0];
    const t = res?.timestamp || [];
    const c = res?.indicators?.quote?.[0]?.close || [];
    const out = [];
    for (let i=0; i<t.length; i++) {
      if (typeof t[i] === "number" && typeof c[i] === "number") {
        const d = new Date(t[i] * 1000).toISOString().slice(0,10);
        out.push({ time: d, value: c[i] });
      }
    }
    return out;
  }

  async function drawChile() {
    const hint = document.getElementById("chart-hint");
    const chart = makeChart(document.getElementById("chart-chile"));
    try {
      // UF + USD/CLP siempre desde mindicador (sólido)
      const { uf, usd } = await getUFyUSD10y();
      let ech = [];
      // Intentar ECH (proxy IPSA) desde Yahoo
      try {
        ech = await getYahooMonthly("ECH", 10);
      } catch (e) {
        console.warn("ECH (Yahoo) no disponible:", e);
        hint.style.display = "block";
        hint.textContent = "Nota: IPSA (proxy ECH) no se pudo cargar desde Yahoo en este momento. Mostrando UF y USD/CLP.";
      }
      // Rebase a 100
      const ufIdx  = toIdx100(uf);
      const usdIdx = toIdx100(usd);
      const echIdx = toIdx100(ech);

      // Alinear por fechas comunes si ECH existe
      let ufFinal = ufIdx, usdFinal = usdIdx, echFinal = echIdx;
      if (echIdx.length) {
        const setUF = new Set(ufIdx.map(p=>p.time));
        const setUS = new Set(usdIdx.map(p=>p.time));
        const common = echIdx.map(p=>p.time).filter(t => setUF.has(t) && setUS.has(t)).sort();
        const mapUF = Object.fromEntries(ufIdx.map(p=>[p.time,p.value]));
        const mapUS = Object.fromEntries(usdIdx.map(p=>[p.time,p.value]));
        const mapEC = Object.fromEntries(echIdx.map(p=>[p.time,p.value]));
        ufFinal  = common.map(t => ({ time:t, value: mapUF[t]  }));
        usdFinal = common.map(t => ({ time:t, value: mapUS[t]  }));
        echFinal = common.map(t => ({ time:t, value: mapEC[t]  }));
      }

      addSeries(chart, "UF (Índice=100)",        COLORS[0], ufFinal);
      addSeries(chart, "USD/CLP (Índice=100)",   COLORS[1], usdFinal);
      if (echFinal.length) {
        addSeries(chart, "IPSA (proxy ECH) (Índice=100)", COLORS[2], echFinal);
      }
      chart.timeScale().fitContent();
    } catch (err) {
      console.error("Error grafico Chile:", err);
      hint.style.display = "block";
      hint.textContent = "Error cargando datos. Intenta recargar la página (Ctrl/Cmd+Shift+R).";
    }
  }

  // Render
  drawChile();
})();
</script>
