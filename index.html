<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitácora Digital: Decisiones en tiempo real para negocios reales</title>
  <meta name="description" content="Dashboards comparativos (TradFi, Índices, Tech, Crypto, Commodities) + Podcast. Educación aplicada en Web3, IA, Analítica, DeFi, TradFi y Fintech." />
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos base (oscuros) -->
  <style>
    :root{
      --bg:#0f1620; --card:#141c27; --line:#243143; --text:#dbe4f3; --muted:#96a3b7; --accent:#2dde9b; --accent2:#4dd3ff;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; line-height:1.55}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .nav{position:sticky;top:0;z-index:20;background:rgba(8,12,18,.7);backdrop-filter: blur(6px); border-bottom:1px solid #0b1119}
    .nav__inner{display:flex;align-items:center;justify-content:space-between;height:56px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:600}
    .brand__logo{width:24px;height:24px}
    .nav__links a{margin-left:20px;color:#b7c3d9}
    .nav__links a:hover{color:#fff}

    .hero{padding:56px 0 26px;border-bottom:1px solid #0b1119}
    .hero__inner{display:grid;grid-template-columns:1.2fr .8fr; gap:20px}
    .hero__copy h1{font-size:40px;margin:.2rem 0 10px}
    .accent{color:var(--accent)}
    .muted{color:var(--muted)}
    .hero__cta{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:999px;border:1px solid #2a394e;background:transparent;color:#cfe3ff}
    .btn:hover{border-color:#4b5d7a}
    .btn--primary{background:#1f9df2;border-color:#1f9df2;color:#031a2a}
    .chips{display:flex;gap:10px;justify-content:flex-end;align-items:flex-end}
    .chip{background:#192234;border:1px solid #273347;padding:10px 8px;border-radius:12px;color:#b3c1d9;min-width:48px;text-align:center}

    /* Grid comparativos (2 filas x 3 columnas) */
    #bd-analytic{padding:28px 0 10px}
    .bd-title{font-size:22px;margin:0 0 4px}
    .bd-subtitle{color:var(--muted);margin:0 0 18px}
    .bd-grid{display:grid;gap:20px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1024px){ .bd-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:680px){ .bd-grid{grid-template-columns:1fr}}
    .bd-card{background:var(--card);border:1px solid #1c2636;border-radius:var(--radius); padding:12px; cursor:pointer}
    .bd-card:hover{border-color:#2e3e55}
    .bd-card.disabled{cursor:default}
    .bd-chart{width:100%;height:300px}
    .bd-note{color:var(--muted);font-size:.92rem;margin-top:6px}

    /* Tooltip del gráfico */
    .bd-tip{
      position:absolute; pointer-events:none;
      background:rgba(17,24,39,.92); color:#e2efff;
      border:1px solid rgba(255,255,255,.12); border-radius:10px;
      padding:8px 10px; font-size:.85rem; transform:translate(8px,8px);
      box-shadow:0 6px 20px rgba(0,0,0,.35); opacity:0; transition:opacity .08s ease; z-index:5; white-space:nowrap;
    }
    .bd-tip.show{opacity:1}
    .bd-tip .row{display:flex;gap:10px;align-items:center;line-height:1.25}
    .bd-tip .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}
    .bd-tip .k{color:#a8c0ff;margin-right:6px}
    .rel{position:relative} /* contenedor para tooltip */
    
    /* Lo que hacemos / Podcast / Footer */
    .section{padding:36px 0}
    .cards-3{display:grid;gap:16px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:900px){.cards-3{grid-template-columns:1fr}}
    .card-soft{background:var(--card);border:1px solid #1c2636;border-radius:var(--radius);padding:16px}
    .embed iframe{border-radius:12px;border:0;width:100%;height:232px}
    .footer{border-top:1px solid #0b1119;padding:18px 0;color:#9fb0c9}
    .footer__inner{display:flex;justify-content:space-between;align-items:center}
  </style>

  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>

  <!-- NAV -->
  <header class="nav">
    <div class="container nav__inner">
      <div class="brand">
        <img src="assets/favicon.svg" alt="" class="brand__logo">
        <span class="brand__name">Bitácora Digital</span>
      </div>
      <nav class="nav__links">
        <a href="#analytic">Dashboards</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
        <a href="#roadmap">Roadmap</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero__inner">
      <div class="hero__copy">
        <h1>Bitácora Digital: <span class="accent">Decisiones en tiempo real</span> para negocios reales</h1>
        <p class="muted">Educación aplicada basada en <strong>Web3, IA, Analítica, DeFi, TradFi y Fintech</strong>. Visión: individuos capacitados para integrar finanzas y tecnología.</p>
        <div class="hero__cta">
          <a class="btn btn--primary" href="#analytic">Ver comparativos</a>
          <a class="btn" href="#podcast">Escuchar podcast</a>
          <a class="btn" href="#servicios">Servicios</a>
          <a class="btn" href="#bd-labs">BD Labs</a>
          <a class="btn" href="#bd-merch">BD Merchandising</a>
          <a class="btn" href="#contacto">Contacto</a>
        </div>
      </div>
      <div class="chips">
        <div class="chip">CLP</div>
        <div class="chip">BTC</div>
        <div class="chip">ETH</div>
        <div class="chip">UF</div>
      </div>
    </div>
  </section>

  <!-- DASHBOARDS COMPARATIVOS -->
  <section id="analytic" class="section">
    <div class="container">
      <h2 class="bd-title">Dashboards comparativos</h2>
      <p class="bd-subtitle">Series mensuales, <em>logarítmicas</em> y normalizadas a <strong>Base 100</strong>. Todos los gráficos sincronizados.</p>

      <div class="bd-grid">
        <!-- 1) TradFi Chile (Interactivo) -->
        <article class="bd-card rel" id="card-chile" onclick="window.location.href='/detail/tradfi-cl'">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
          <p class="bd-note" style="margin-top:0">UF / US$ desde mindicador.cl · IPSA vía ETF ECH (Stooq)</p>
          <div id="c-chile" class="bd-chart"></div>
          <div id="tip-chile" class="bd-tip"></div>
          <div id="note-chile" class="bd-note" style="display:none"></div>
        </article>

        <!-- 2) Índices (placeholder listo para conectar) -->
        <article class="bd-card disabled" id="card-indices" onclick="window.location.href='/detail/indices'">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">Índices — SPY (S&amp;P500) vs EWG (DAX) vs EWJ (Nikkei)</h3>
          <p class="bd-note" style="margin-top:0">ETF proxies vía Stooq (mensual)</p>
          <div id="c-indices" class="bd-chart"></div>
          <div class="bd-note">Próximamente.</div>
        </article>

        <!-- 3) Tech (placeholder) -->
        <article class="bd-card disabled" id="card-tech" onclick="window.location.href='/detail/tech'">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">Big Tech / IA — AAPL vs MSFT vs NVDA</h3>
          <p class="bd-note" style="margin-top:0">Precios USD vía Stooq (mensual)</p>
          <div id="c-tech" class="bd-chart"></div>
          <div class="bd-note">Próximamente.</div>
        </article>

        <!-- 4) Crypto (placeholder) -->
        <article class="bd-card disabled" id="card-crypto" onclick="window.location.href='/detail/crypto'">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">Crypto · Top 8 (Base 100, últimos 5 años)</h3>
          <p class="bd-note" style="margin-top:0">BTC, ETH, SOL, BNB, XRP, ADA, LINK, DOT — CoinGecko (USD)</p>
          <div id="c-crypto" class="bd-chart"></div>
          <div class="bd-note">Próximamente.</div>
        </article>

        <!-- 5) Commodities (placeholder) -->
        <article class="bd-card disabled" id="card-commod" onclick="window.location.href='/detail/commodities'">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">Commodities (ETF) — IAU (Oro) vs SLV (Plata) vs BNO (Brent)</h3>
          <p class="bd-note" style="margin-top:0">ETF proxies vía Stooq (mensual)</p>
          <div id="c-commod" class="bd-chart"></div>
          <div class="bd-note">Próximamente.</div>
        </article>

        <!-- 6) Libre -->
        <article class="bd-card disabled">
          <h3 class="bd-title" style="font-size:18px;margin:4px 0 6px">Próximamente</h3>
          <p class="bd-note">Otro comparativo que elijas. Sugerencias: LatAm, Small Caps o BTC vs Oro vs SPY.</p>
          <div class="bd-chart"></div>
        </article>
      </div>
    </div>
  </section>

  <!-- LO QUE HACEMOS -->
  <section class="section" id="servicios">
    <div class="container">
      <h2 class="bd-title">Lo que hacemos</h2>
      <div class="cards-3">
        <article class="card-soft">
          <h4>Educación primero</h4>
          <p>Somos un medio educativo: finanzas, IA, blockchain y analítica — sin “shilling” ni promesas mágicas.</p>
        </article>
        <article class="card-soft">
          <h4>Dashboards a medida</h4>
          <p>Discovery → Integración → Despliegue → Mantenimiento. Datos que se entienden y toman decisiones.</p>
        </article>
        <article class="card-soft">
          <h4>IA / DeFi / Pagos</h4>
          <p>Agentes de IA para tu negocio, consultoría DeFi y pasarelas fiat↔crypto con buenas prácticas.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- PODCAST -->
  <section id="podcast" class="section">
    <div class="container">
      <h2 class="bd-title">Podcast</h2>
      <p class="bd-subtitle">Escucha los últimos episodios sin salir de la web.</p>
      <div class="embed">
        <iframe src="https://open.spotify.com/embed/show/1wUiA7esT4Mx8OUA16PSyo?utm_source=generator" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
      </div>
    </div>
  </section>

  <!-- ROADMAP (simple placeholder) -->
  <section id="roadmap" class="section">
    <div class="container">
      <h2 class="bd-title">Roadmap</h2>
      <ol class="bd-note" style="line-height:1.9">
        <li><strong>v0.1</strong> · Maqueta con dashboard en vivo (Crypto + CLP/UF). ✅</li>
        <li><strong>v0.2</strong> · Comparativos interactivos + detalle por gráfico. ✅</li>
        <li><strong>v0.3</strong> · Commodities e índices extra. 🔜</li>
        <li><strong>v0.4</strong> · Alertas / Email digests. 🔜</li>
      </ol>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">© 2025 Bitácora Digital</span>
      <div class="footer__links">
        <a href="/">Inicio</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
      </div>
    </div>
  </footer>

<script>
/* ===========================================================
   Utilidades comunes
   =========================================================== */
const COLORS = ["#63b3ed","#f6ad55","#97a7ea","#66e4a6","#ff6585","#b794f4","#4fd1c5","#fbd38d"];
const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
const isoMonth = d => {
  const y=d.getUTCFullYear(), m=String(d.getUTCMonth()+1).padStart(2,"0");
  return `${y}-${m}-01`;
};
// Normaliza Base 100 (desde primer valor válido)
function base100(arr){
  if(!arr?.length) return arr;
  const i = arr.findIndex(p=>Number.isFinite(p.value));
  if(i<0) return arr;
  const b = arr[i].value;
  return arr.map(p=>({ time:p.time, value:(p.value/b)*100 }));
}
// Intersección de fechas entre N series
function intersectDates(seriesArray){
  const sets = seriesArray.map(s=> new Set(s.map(p=>p.time)));
  const common = [...sets[0]].filter(t=> sets.every(S => S.has(t))).sort((a,b)=>a.localeCompare(b));
  return seriesArray.map(s => s.filter(p=> common.includes(p.time)));
}
// A mensual (último de cada mes)
function toMonthlyLast(points){
  const by={}; for(const p of points) by[p.time]=p.value;
  return Object.entries(by).map(([time,value])=>({time,value}))
    .sort((a,b)=> a.time.localeCompare(b.time));
}

/* ===========================================================
   Fetchers
   =========================================================== */
// mindicador.cl (uf / dolar) — diario → mensual
async function fetchMindicador(tipo){
  const r = await fetch(`https://mindicador.cl/api/${tipo}`, { cache:'no-store' });
  if(!r.ok) throw new Error(`mindicador ${tipo} ${r.status}`);
  const j = await r.json(); // j.serie:[{fecha,valor}]
  const pts = j.serie.map(x=>{
    const d=new Date(x.fecha);
    return { time: isoMonth(new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), 1))), value: Number(x.valor) };
  });
  return toMonthlyLast(pts);
}
// Stooq mensual (close)
async function fetchStooqMonthly(ticker){
  const r = await fetch(`https://stooq.com/q/d/l/?s=${ticker}&i=m`, { cache:'no-store' });
  if(!r.ok) throw new Error(`stooq ${ticker} ${r.status}`);
  const csv = await r.text();
  const lines = csv.trim().split(/\r?\n/).slice(1);
  const out=[];
  for(const ln of lines){
    const [date,open,high,low,close,vol] = ln.split(',');
    if(!date || !close) continue;
    out.push({ time: date, value: Number(close) });
  }
  return out;
}

/* ===========================================================
   Chart helpers
   =========================================================== */
function makeChart(el){
  return LightweightCharts.createChart(el, {
    layout: { background:{type:'solid', color:'transparent'}, textColor:'#cfe0ff' },
    rightPriceScale:{ borderColor:'#233048', mode:1 }, // 1: log
    timeScale:{ borderColor:'#233048', rightOffset:2 },
    grid:{ vertLines:{ color:'#1a2434' }, horzLines:{ color:'#1a2434' } },
    localization:{ locale:'es-CL' },
  });
}
function addLine(chart, label, color){
  return chart.addLineSeries({ title:label, color, lineWidth:2 });
}

/* ===========================================================
   TradFi · Chile (UF vs USD/CLP vs IPSA proxy ECH)
   =========================================================== */
async function drawChile(){
  const root = document.getElementById('c-chile');
  const tip  = document.getElementById('tip-chile');
  const note = document.getElementById('note-chile');
  if(!root) return;

  try{
    // 1) Traer las 3 series
    const [uf, usd, ech] = await Promise.all([
      fetchMindicador('uf'),
      fetchMindicador('dolar'),
      fetchStooqMonthly('ech.us')
    ]);

    // 2) Alinear fechas y normalizar a Base 100
    let [S1,S2,S3] = intersectDates([uf, usd, ech]);
    S1 = base100(S1); S2 = base100(S2); S3 = base100(S3);

    // 3) Chart
    const chart = makeChart(root);
    const L1 = addLine(chart,'UF',COLORS[0]); L1.setData(S1);
    const L2 = addLine(chart,'USD/CLP',COLORS[1]); L2.setData(S2);
    const L3 = addLine(chart,'IPSA (ECH)',COLORS[2]); L3.setData(S3);

    // 4) Tooltip sincronizado
    const series = [
      { label:'UF',       color:COLORS[0], line:L1, data:S1 },
      { label:'USD/CLP',  color:COLORS[1], line:L2, data:S2 },
      { label:'IPSA (ECH)', color:COLORS[2], line:L3, data:S3 },
    ];

    function fmt(n){ return (Math.round(n*100)/100).toLocaleString('es-CL') }
    function htmlTip(dateISO, points){
      const d = new Date(dateISO+'T00:00:00Z');
      const head = d.toLocaleDateString('es-CL', {year:'numeric', month:'short'});
      const rows = points.map(p=>(
        `<div class="row"><span class="dot" style="background:${p.color}"></span>
           <span class="k">${p.label}</span><strong>${fmt(p.value)}</strong>
         </div>`
      )).join('');
      return `<div style="margin-bottom:6px;opacity:.9">${head}</div>${rows}`;
    }

    chart.subscribeCrosshairMove(param=>{
      if(!param?.time){ tip.classList.remove('show'); return; }
      const t = param.time; // formato YYYY-MM-DD
      const pts = [];
      for(const s of series){
        const hit = s.data.find(p=>p.time===t);
        if(hit) pts.push({ label:s.label, color:s.color, value:hit.value });
      }
      if(!pts.length){ tip.classList.remove('show'); return; }
      tip.innerHTML = htmlTip(t, pts);
      tip.style.left = (param.point.x + 12) + 'px';
      tip.style.top  = (param.point.y + 12) + 'px';
      tip.classList.add('show');
    });
    root.addEventListener('mouseleave', ()=> tip.classList.remove('show'));

  }catch(e){
    console.warn(e);
    note.textContent = "No se pudo cargar (Chile).";
    note.style.display = 'block';
  }
}

/* ===========================================================
   Bootstrap
   =========================================================== */
window.addEventListener('DOMContentLoaded', ()=>{
  drawChile(); // Primer cuadrante activo
});
</script>

</body>
</html>
