<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitácora Digital — Dashboards + Podcast</title>
  <meta name="description" content="Dashboards limpios con datos de mercados (TradFi, Commodities, Crypto) y podcast de educación financiera y tecnología." />
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container nav__inner">
      <div class="brand">
        <img src="assets/favicon.svg" alt="" class="brand__logo">
        <span class="brand__name">Bitácora Digital</span>
      </div>
      <nav class="nav__links">
        <a href="#dashboards">Dashboards</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
        <a href="#roadmap">Roadmap</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero__inner">
      <div class="hero__copy">
        <h1>Decisiones en <span class="accent">tiempo real</span> para negocios reales</h1>
        <p class="muted">Web3, DeFi, analítica y TradFi — educación aplicada, sin humo. Dashboards claros que se entienden y se usan.</p>
        <div class="hero__cta">
          <a class="btn btn--primary" href="#dashboards">Ver dashboards</a>
          <a class="btn" href="#podcast">Escuchar podcast</a>
        </div>
      </div>
      <div class="hero__snapshot">
        <div class="chip">CLP</div>
        <div class="chip">BTC</div>
        <div class="chip">ETH</div>
        <div class="chip">UF</div>
      </div>
    </div>
  </section>

  <!-- DASHBOARDS -->
<section class="section" id="charts-crypto">
  <div class="container">
    <h3 class="group__title">Crypto · Top 8 (Base 100, últimos 5 años)</h3>
    <p class="muted">Fuente directa: CoinCap (precios en USD). Serie normalizada a Base 100 en la primera fecha.</p>

    <div class="card soft" style="padding:1rem">
      <canvas id="chart-crypto" height="120"></canvas>
    </div>
  </div>
</section>

  
  <section id="dashboards" class="section">
    <div class="container">
      <h2 class="section__title">Dashboards</h2>
      <p class="section__subtitle">Vista compacta. Si hay APIs, se actualiza solo. Si no, verás “—” (sin romper nada).</p>

      <!-- FILA: TRADFI CHILE -->
      <h3 class="group__title">TradFi · Chile</h3>
      <div class="grid">
        <article class="card" data-key="UF">
          <header class="card__head">
            <span class="pill">UF</span>
            <span class="muted">Unidad de Fomento</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
        </article>

        <article class="card" data-key="USDCLP">
          <header class="card__head">
            <span class="pill">USD/CLP</span>
            <span class="muted">Dólar observado</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
        </article>

        <article class="card disabled" data-key="IPSA">
          <header class="card__head">
            <span class="pill">IPSA</span>
            <span class="muted">Bolsa de Santiago</span>
          </header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Actívalo con clave gratuita (finnhub / alpha vantage).</div>
        </article>
      </div>

      <!-- FILA: ÍNDICES USA/EU -->
      <h3 class="group__title">Índices · USA / Europa</h3>
      <div class="grid">
        <article class="card disabled" data-key="SP500">
          <header class="card__head"><span class="pill">S&P 500</span><span class="muted">EE.UU.</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
        <article class="card disabled" data-key="DAX">
          <header class="card__head"><span class="pill">DAX</span><span class="muted">Alemania</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
        <article class="card disabled" data-key="NIKKEI">
          <header class="card__head"><span class="pill">Nikkei 225</span><span class="muted">Japón</span></header>
          <div class="card__value" data-field="price">—</div>
          <div class="card__delta" data-field="delta">—</div>
          <div class="hint">Usa tu API KEY para habilitar.</div>
        </article>
      </div>

      <!-- FILA: TECH STOCKS -->
      <h3 class="group__title">Acciones · Big Tech / IA / Chips</h3>
      <div class="grid">
        <article class="card disabled" data-key="AAPL"><header class="card__head"><span class="pill">AAPL</span><span class="muted">Apple</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="MSFT"><header class="card__head"><span class="pill">MSFT</span><span class="muted">Microsoft</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="NVDA"><header class="card__head"><span class="pill">NVDA</span><span class="muted">NVIDIA</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="TSM"><header class="card__head"><span class="pill">TSM</span><span class="muted">TSMC</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>

      <!-- FILA: CRYPTO (LIVE) -->
      <h3 class="group__title">Crypto · Top 8 (live)</h3>
      <div class="grid">
        <article class="card" data-coin="bitcoin"><header class="card__head"><span class="pill">BTC</span><span class="muted">Bitcoin</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="ethereum"><header class="card__head"><span class="pill">ETH</span><span class="muted">Ethereum</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="solana"><header class="card__head"><span class="pill">SOL</span><span class="muted">Solana</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="ripple"><header class="card__head"><span class="pill">XRP</span><span class="muted">XRP</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="binancecoin"><header class="card__head"><span class="pill">BNB</span><span class="muted">BNB</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="cardano"><header class="card__head"><span class="pill">ADA</span><span class="muted">Cardano</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="chainlink"><header class="card__head"><span class="pill">LINK</span><span class="muted">Chainlink</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card" data-coin="polkadot"><header class="card__head"><span class="pill">DOT</span><span class="muted">Polkadot</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>

      <!-- FILA: COMMODITIES -->
      <h3 class="group__title">Commodities · Metales / Energía</h3>
      <div class="grid">
        <article class="card disabled" data-key="GOLD"><header class="card__head"><span class="pill">Oro</span><span class="muted">XAU</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div><div class="hint">Habilita con MetalsAPI/AlphaVantage.</div></article>
        <article class="card disabled" data-key="SILVER"><header class="card__head"><span class="pill">Plata</span><span class="muted">XAG</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
        <article class="card disabled" data-key="BRENT"><header class="card__head"><span class="pill">Brent</span><span class="muted">Crudo</span></header><div class="card__value" data-field="price">—</div><div class="card__delta" data-field="delta">—</div></article>
      </div>
    </div>
  </section>

<section class="section" id="charts-crypto">
  <div class="container">
    <h3 class="group__title">Crypto · Top 8 (Base 100, últimos 5 años)</h3>
    <p class="muted">Fuente: CoinGecko (USD, normalizado a Base 100). Si no ves nada, recarga (Ctrl+F5).</p>
    <div class="card soft" style="padding:1rem">
      <div id="chart-crypto" style="height:320px"></div>
    </div>
  </div>
</section>

  
  <!-- MISIÓN / SERVICIOS -->
  <section class="section alt" id="servicios">
    <div class="container">
      <h2 class="section__title">Lo que hacemos</h2>
      <div class="cards-3">
        <article class="card soft">
          <h4>Educación primero</h4>
          <p>Somos un medio educativo: finanzas, IA, blockchain y analítica — sin “shilling” ni promesas mágicas.</p>
        </article>
        <article class="card soft">
          <h4>Dashboards a medida</h4>
          <p>Discovery → Integración → Despliegue → Mantenimiento. Datos que se entienden y toman decisiones.</p>
        </article>
        <article class="card soft">
          <h4>IA / DeFi / Pagos</h4>
          <p>Agentes de IA para tu negocio, consultoría DeFi y pasarelas fiat↔crypto con buenas prácticas.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- PODCAST -->
  <section id="podcast" class="section">
    <div class="container">
      <h2 class="section__title">Podcast</h2>
      <p class="section__subtitle">Escucha los últimos episodios sin salir de la web.</p>
      <div class="embed">
        <iframe style="border-radius:12px" src="https://open.spotify.com/embed/show/1wUiA7esT4Mx8OUA16PSyo?utm_source=generator" width="100%" height="232" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
      </div>
    </div>
  </section>

  <!-- ROADMAP -->
  <section id="roadmap" class="section alt">
    <div class="container">
      <h2 class="section__title">Roadmap</h2>
      <ol class="roadmap">
        <li><strong>v0.1</strong> · Maqueta con dashboard en vivo (Crypto + CLP/UF). ✅</li>
        <li><strong>v0.2</strong> · Conectar índices y acciones con API gratuita (Finnhub/Alpha Vantage). 🔜</li>
        <li><strong>v0.3</strong> · Commodities y alertas simples. 🔜</li>
        <li><strong>v0.4</strong> · Email digests + panel admin para noticias. 🔜</li>
      </ol>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">© 2025 Bitácora Digital</span>
      <div class="footer__links">
        <a href="https://bitacoradigital.io" target="_blank" rel="noopener">Sitio</a>
        <a href="#podcast">Podcast</a>
        <a href="#servicios">Servicios</a>
      </div>
    </div>
  </footer>


<!-- Lightweight Charts (gráficos livianos) -->
<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
  .bd-grid { display:grid; gap:24px; margin-top:32px }
  .bd-2 { grid-template-columns: 1fr 1fr }
  .bd-1 { grid-template-columns: 1fr }
  .bd-card { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px }
  .bd-title { font-weight:600; margin:4px 0 10px 6px; opacity:.9 }
  .bd-chart { width:100%; height:360px }
  @media (max-width:1000px){ .bd-2{grid-template-columns:1fr} }
</style>

<section class="container">
  <h2 class="section__title">Dashboards comparativos</h2>
  <p class="section__subtitle">Series normalizadas (Índice = 100 al inicio del rango) para comparar movimientos.</p>

  <div class="bd-grid bd-2">
    <div class="bd-card">
      <h3 class="bd-title">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
      <div id="chart-chile" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">UF/US$ desde mindicador.cl · IPSA proxy vía ECH (Yahoo). Rango: 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Índices · S&P500 (SPY) vs DAX (EWG) vs Nikkei (EWJ)</h3>
      <div id="chart-indices" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance, rango 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Big Tech · AAPL vs MSFT vs NVDA</h3>
      <div id="chart-tech" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance, rango 10 años mensuales.</p>
    </div>

    <div class="bd-card">
      <h3 class="bd-title">Commodities (ETF) · Oro (IAU) vs Plata (SLV) vs Brent (BNO)</h3>
      <div id="chart-commod" class="bd-chart"></div>
      <p class="muted" style="margin:8px 4px 0">Yahoo Finance (ETF proxies), rango 10 años mensuales.</p>
    </div>
  </div>
</section>

<!-- Lightweight Charts (gráficos livianos) -->
<script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
  .bd-dash { margin: 36px auto; max-width: 1100px; padding: 0 16px; }
  .bd-card { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; margin-bottom:24px; }
  .bd-title { font-weight:600; margin:4px 0 10px 6px; opacity:.9 }
  .bd-muted { color:#a0aec0; font-size: 0.9rem; margin:6px 4px 0 }
  .bd-chart { width:100%; height:380px }
  .bd-note { color:#cbd5e0; font-size: .85rem; margin: 6px 4px 0 }
</style>

<section class="bd-dash">
  <div class="bd-card">
    <h3 class="bd-title">TradFi · Chile — UF vs USD/CLP vs IPSA (proxy ECH)</h3>
    <div id="chart-chile" class="bd-chart"></div>
    <p class="bd-muted">UF y USD/CLP desde mindicador.cl · IPSA se intenta vía ECH (Yahoo). Rango: 10 años, mensual. Base 100.</p>
    <p id="chart-hint" class="bd-note" style="display:none"></p>
  </div>
</section>

<script>
(function () {
  // ===== Utilidades comunes =====
  const COLORS = ["#63b3ed","#a4d1c5","#f6ad55","#f56565","#9f7aea","#48bb78","#ed64a6","#4299e1"];
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  // Normaliza a Base 100 tomando el primer valor válido de cada serie
  function toBase100(series) {
    if (!series.length) return series;
    const baseIdx = series.findIndex(p => Number.isFinite(p.value));
    if (baseIdx < 0) return series;
    const base = series[baseIdx].value;
    return series.map(p => ({ time: p.time, value: (p.value / base) * 100 }));
  }

  function makeChart(el, dark = true) {
    return LightweightCharts.createChart(el, {
      layout: {
        background: { type: 'solid', color: 'transparent' },
        textColor: dark ? '#cbd5e0' : '#1a202c'
      },
      rightPriceScale: { borderColor: '#2d3748' },
      timeScale:      { borderColor: '#2d3748' },
      grid: { vertLines: { color: '#1a202c' }, horzLines: { color: '#1a202c' } },
      localization: { locale: 'es-CL' }
    });
  }

  function addLineSeries(chart, title, color) {
    const s = chart.addLineSeries({ title, color, lineWidth: 2 });
    return s;
  }

  function monthISO(d) {
    const y = d.getUTCFullYear();
    const m = String(d.getUTCMonth() + 1).padStart(2, '0');
    return `${y}-${m}-01`;
  }

  // ====== CRYPTO TOP 8 (CoinGecko) ======
  /**
   * Obtiene histórico diario de N días para un coin (CoinGecko) y lo lleva a formato:
   * [ {time: 'YYYY-MM-DD', value: <precio>} ]
   */
  async function cgHistory(coin, days = 1825) { // ~5 años
    // Nota: CoinGecko está rate-limited. Si pegas 8 queries en paralelo puede tardar;
    // por eso ponemos un pequeño sleep entre requests.
    const url = `https://api.coingecko.com/api/v3/coins/${coin}/market_chart?vs_currency=usd&days=${days}`;
    const r = await fetch(url, { cache: 'no-store' });
    if (!r.ok) throw new Error(`CG ${coin} ${r.status}`);
    const data = await r.json();
    // data.prices = [ [ts_ms, price], ... ]
    const out = data.prices.map(([ts, price]) => {
      const d = new Date(ts);
      return { time: monthISO(new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), 1))), value: price };
    });
    // Compacta a 1 punto por mes (último valor del mes)
    const byMonth = {};
    for (const p of out) byMonth[p.time] = p.value;
    return Object.entries(byMonth).map(([time, value]) => ({ time, value })).sort((a,b)=> a.time.localeCompare(b.time));
  }

  async function drawCryptoTop8() {
    const el = document.getElementById('chart-crypto');
    if (!el) return;

    // COINS: BTC, ETH, SOL, BNB, XRP, ADA, LINK, DOT
    const coins = [
      { id: 'bitcoin',     label: 'BTC'  },
      { id: 'ethereum',    label: 'ETH'  },
      { id: 'solana',      label: 'SOL'  },
      { id: 'binancecoin', label: 'BNB'  },
      { id: 'ripple',      label: 'XRP'  },
      { id: 'cardano',     label: 'ADA'  },
      { id: 'chainlink',   label: 'LINK' },
      { id: 'polkadot',    label: 'DOT'  },
    ];

    // Crea chart
    const chart = makeChart(el, true);

    // Trae cada serie con un pequeño delay para no chocar rate-limit
    const series = [];
    for (let i = 0; i < coins.length; i++) {
      const c = coins[i];
      try {
        const raw = await cgHistory(c.id, 1825);
        const norm = toBase100(raw);
        series.push({ label: c.label, data: norm });
      } catch (e) {
        console.error('CG fail', c.id, e);
      }
      await sleep(300); // respiro para el rate-limit
    }

    // Sin datos? aviso
    if (!series.length) {
      el.innerHTML = '<div style="padding:1rem;color:#a0aec0">No se pudo cargar el comparativo (CoinGecko limit). Intenta recargar.</div>';
      return;
    }

    // Dibuja cada línea
    series.forEach((s, i) => {
      const color = COLORS[i % COLORS.length];
      const line = addLineSeries(chart, s.label, color);
      line.setData(s.data);
    });
  }

  // === Bootstrap ===
  window.addEventListener('load', () => {
    drawCryptoTop8();  // ← ya deja el primer comparativo funcionando
  });
})();
</script>
